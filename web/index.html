<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Pong</title>
<link rel="stylesheet" href="/style.css">
<body>

<div id="loading">loading...</div>

<canvas id="canvas"></canvas>

<script type='text/javascript'>
const ce = document.getElementById('canvas');
const le = document.getElementById('loading');

ce.addEventListener('webglcontextlost', (e) => {
	const msg = 'WebGL context lost. You will need to reload the page.';
	console.error(msg);
	alert(msg);
	e.preventDefault();
}, false);

var Module = {
	arguments: ["-W", "24", "-H", "16", "-r", "6"],
	print(...args) {
		console.log('print', ...args);
	},
	canvas: ce,
	setStatus(text) {
		if (text.startsWith('Downloading')) {
			le.innerText = text;
			return
		}
		if (text.startsWith('Running...')) {
			le.style.display = 'none';
			ce.style.display = 'block';
			return;
		}
	},
	totalDependencies: 0,
	monitorRunDependencies(left) {
		this.totalDependencies = Math.max(this.totalDependencies, left);
	}
};
Module.setStatus('Downloading...');
window.onerror = (event) => {
	// TODO: do not warn on ok events like simulating an infinite loop or exitStatus
	Module.setStatus('Exception thrown, see JavaScript console');
	Module.setStatus = (text) => {
		if (text) {
			console.error('[post-exception status] ' + text);
		}
	};
};
</script>
<script async type="text/javascript" src="pong.js"></script>
</body>
</html>
